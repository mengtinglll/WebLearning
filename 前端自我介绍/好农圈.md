# 功能
好农圈是一个类似于小红书的果蔬产品社交分享平台，用户可以根据自己的喜好加入或者创建不同的圈子，找到喜好相同的人，并通过在圈子内发帖，随时分享优质的果蔬产品。
而好农圈后台管理系统就是用来管理用户、圈子以及帖子的，可以对用户进行禁言拉黑和恢复，对圈子和帖子进行审核以及权限修改的操作。此外，还有一些后台数据的统计，方便管理员直观地了解当前平台的运行情况。

# 技术栈和分工
好农圈本身是实验室的一个项目，主要由师兄师姐负责；而后台管理系统就主要由我负责；
首先是通过手脚架创建umi项目，用的是react，组件库是antDesign，ajax库是Axios；

# 流程
用户登录后就将用户名和token存入localstorage，同时也会获取分类列表和地区列表等公共数据，存入localstorage；

### 登录拦截
umi 约定 src 目录下的 app.js 为运行时的配置文件。app.js中规定好onRouteChange

在路由变化时，会读取localstorage保存的token，如果token不存在，就跳转到登录页面。同时将不需要权限控制的登录页面路由设置为白名单。

接口层则是设置拦截器，将token加到请求头中。请求错误时，规定状态码为401是token过期，跳转到登录页面。

### 管理页面
进入管理系统后，主要的功能就是用户、圈子、帖子的管理，他们是类似的，首先有个表格显示名称、管理员、创建日期、封面头像、分类标签和权限。
其中分类和地区是从后台传来相应的编码，我们要将他映射成响应的字符串；
权限既是信息的展示也可以是操作按钮。比如，某个圈子显示未通过审核状态，管理员可以点击该图标，通过弹出对话框对圈子进行审核。由于这个是通用的，所以我把它封装成了一个公共组件。
表格可以进行排序、筛选和搜索。

### 后台接口
后台的部分是师兄师姐搭好的，我只负责后台管理系统用到的一些简单的接口，比如获取列表信息，权限管理操作。后台用到的是egg+mongoDB+mongoose。

# 收获
开发前我们一起讨论技术选型，师姐之前实习的时候有用过umi，她觉得挺不错的，所以我们就选定的umi+dva的组合，也是用了typescript规范代码。

这些在之前我都是没有接触过的。仅仅是通过官方文档来学习，通过短短一个多月的时间负责并完成这个项目，我认为我是具备良好的学习能力以及执行力的。

### 重构
最近我在尝试使用taro重构好农圈，目前是搭好一个框架。

### 遇到的问题和解决1
从圈子列表点击进入具体某一个圈子详情页时，是通过路由跟上圈子id` <Link to={`userDetail?id=${status._id}`}>`
详情页在生命周期componentDidMount中从location中获取圈子id，根据id向后台发送请求获得详情信息的。
但在此之前，react已经完成了render首次渲染，首次渲染时并没有圈子的详情数据，所以通过点操作符获取详情数据是会报错的
所以在render中要首先进行判断，是否已经准备好数据，若无数据，则渲染加载画面
### 遇到的问题和解决2
场景：用户在平台的等级除了根据用户活跃度自动升级以外，还可以通过后台管理系统，由管理员给他手动升级
点击按钮后调用setState给user.level+1，如果是供应商用户，则额外再增加1级。但是我发现这个额外增加的1级不会实现。
定位：更改成供应商额外增加0.5，发现结果只增加了0.5，所以推测注意到setState并不是同步的，对相同属性的设置只保留最后一次的设置
解决：然后我就去了解了react中setState的执行机制。为了减少重绘，react在一个渲染周期中

### 遇到的问题和解决3红树林
在设计注册页面时，要对用户输入的信息进行校验
